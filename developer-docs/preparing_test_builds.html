


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Test builds &mdash; InaSAFE 1.0.1-final documentation</title>
    
    <link rel="stylesheet" href="../_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noticia+Text|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.1-final',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../_static/toggle_sections.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="InaSAFE 1.0.1-final documentation" href="../index.html" />
    <link rel="up" title="InaSAFE developer documentation" href="index.html" />
    <link rel="next" title="Continuous Integration Testing with Jenkins" href="jenkins_ci.html" />
    <link rel="prev" title="Preparing a release" href="preparing_a_release.html" /> 
  </head>
  <body>
    <div class="relbar-top">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="jenkins_ci.html" title="Continuous Integration Testing with Jenkins"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="preparing_a_release.html" title="Preparing a release"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Home</a> &raquo;</li>
    <li><a href="../contents.html">Contents</a> &raquo;</li>

          <li><a href="index.html" accesskey="U">InaSAFE developer documentation</a> &raquo;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="test-builds">
<h1>Test builds<a class="headerlink" href="#test-builds" title="Permalink to this headline">¶</a></h1>
<p>Test builds are created using fabric (<a class="reference external" href="http://fabfile.org">http://fabfile.org</a>) and a bash script.</p>
<p>Test builds are intended for early adopters / testers who want to use the
bleeding edge version of InaSAFE.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Using test builds may result in strange behaviour or bad things
happening when you run your assessment. We try our best to keep the master
in a good, usable and secure (for you) state, but we can&#8217;t guarantee this
will always be the case.</p>
</div>
<p>This document has two sections:</p>
<ul class="simple">
<li>How to configure QGIS to use the InaSAFE test builds repo.</li>
<li>How to set up a test build server (intended only for sysadmins).</li>
</ul>
<div class="section" id="configuring-qgis-to-use-test-builds-from-linfiniti-server">
<h2>Configuring QGIS to use test builds (from Linfiniti server).<a class="headerlink" href="#configuring-qgis-to-use-test-builds-from-linfiniti-server" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><em class="menuselection">Plugins ‣ Fetch Python Plugins ‣ Repository Tab ‣ Add...</em></li>
<li><em class="guilabel">Name:</em> <tt class="kbd docutils literal"><span class="pre">InaSAFE</span> <span class="pre">Testing</span></tt></li>
<li><em class="guilabel">URL:</em> <tt class="kbd docutils literal"><span class="pre">http://inasafe-test.linfiniti.com/plugins.xml</span></tt></li>
<li><em class="guilabel">OK</em></li>
</ul>
<p>In the <em class="guilabel">Options</em> tab, tick the
<em class="guilabel">Show all plugins, even those marked as experimental</em> option.</p>
<p>You should now see the experimental versions of InaSAFE listed in the
<em class="guilabel">Plugins</em> tab.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The URL may differ depending on where the test repo is hosted (see
below).</p>
</div>
</div>
<div class="section" id="configuring-the-hosting-of-the-test-build-repo">
<h2>Configuring the hosting of the test build repo.<a class="headerlink" href="#configuring-the-hosting-of-the-test-build-repo" title="Permalink to this headline">¶</a></h2>
<div class="section" id="register-a-sub-domain">
<h3>Register a (sub)domain:<a class="headerlink" href="#register-a-sub-domain" title="Permalink to this headline">¶</a></h3>
<p>To host your repo, you should create a DNS domain or subdomain reserved
exclusively for use of the fabric script &amp; repo. For example during the recent
floods in Jakarta (Jan 2013), we registered a new subdomain
&#8216;inasafe-crisis.linfiniti.com&#8217; by creating the following &#8216;a record&#8217; (alias
record) on our DNS server configuration panel:</p>
<div class="highlight-python"><pre>record type     value
    a           inasafe-crisis.linfiniti.com</pre>
</div>
</div>
<div class="section" id="prepare-a-server-name-mapping">
<h3>Prepare a server/name mapping:<a class="headerlink" href="#prepare-a-server-name-mapping" title="Permalink to this headline">¶</a></h3>
<p>The purpose of the server/name mapping is to determine what (sub)domain to
publish the repo under. This is carried out via a simple dictionary. For
example running <tt class="samp docutils literal"><span class="pre">hostname</span></tt> on the deployment server might return
&#8216;linfiniti&#8217; in which case to deploy the inasafe-crisis.linfiniti.com repo we
would add an entry to the fabfile.py as follows:</p>
<div class="highlight-python"><pre>def _all():
    """Things to do regardless of whether command is local or remote."""
    site_names = {
        'waterfall': 'inasafe-test.localhost',
        'spur': 'inasafe-test.localhost',
        'maps.linfiniti.com': 'inasafe-test.linfiniti.com',
        'linfiniti': 'inasafe-crisis.linfiniti.com}</pre>
</div>
<p>Basically, this last key-value pair says &#8216;if the hostname command on the server
returns &#8220;linfiniti&#8221; then deploy a web site called inasafe-crisis on that
server&#8217;. The resultant web site will have a new repository created that a
user could add to their QGIS plugin repository list as:</p>
<div class="highlight-python"><pre>http://inasafe-crisis.linfiniti.com/plugins.xml</pre>
</div>
</div>
<div class="section" id="prepare-your-server">
<h3>Prepare your server:<a class="headerlink" href="#prepare-your-server" title="Permalink to this headline">¶</a></h3>
<p>Install some packages (run this on the server):</p>
<div class="highlight-python"><pre>sudo apt-get install git fabric apache2</pre>
</div>
</div>
<div class="section" id="create-a-package">
<h3>Create a package:<a class="headerlink" href="#create-a-package" title="Permalink to this headline">¶</a></h3>
<p>Initialise everything (run this on your desktop):</p>
<div class="highlight-python"><pre>fab -H 188.40.123.80:8697 remote build_test</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You need to be able to authenticate on the server hosting the
test builds.</p>
</div>
<p>The above would create a test package based on current master by default. You
can also specify a branch to build the package from like this:</p>
<div class="highlight-python"><pre>fab -H 188.40.123.80:8697 remote build_test_package:branch=version-1_1</pre>
</div>
</div>
<div class="section" id="version-number-increments">
<h3>Version number increments:<a class="headerlink" href="#version-number-increments" title="Permalink to this headline">¶</a></h3>
<p>One problem you may want to consider is that if you release consecutive test
builds with the same version number, the python plugin manager in QGIS will not
indicate that a new package is available. For this reason we recommend adding
an incremental build number to the version numbers in <tt class="file docutils literal"><span class="pre">__init__.py</span></tt> and
<tt class="file docutils literal"><span class="pre">metadata.txt</span></tt>. For example:</p>
<div class="highlight-python"><pre>version=1.1.0-1</pre>
</div>
<p>In this case the &#8216;-1&#8217; at the end of the version number designates that it
is build 1. You should manually increment this number and commit it <strong>to
the branch you are building</strong> each time before creating a package.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="../contents.html">
          <img class="logo" src="../_static/icon.png" alt="Logo"/>
        </a></p>
  <h3><a href="../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Test builds</a><ul>
<li><a class="reference internal" href="#configuring-qgis-to-use-test-builds-from-linfiniti-server">Configuring QGIS to use test builds (from Linfiniti server).</a></li>
<li><a class="reference internal" href="#configuring-the-hosting-of-the-test-build-repo">Configuring the hosting of the test build repo.</a><ul>
<li><a class="reference internal" href="#register-a-sub-domain">Register a (sub)domain:</a></li>
<li><a class="reference internal" href="#prepare-a-server-name-mapping">Prepare a server/name mapping:</a></li>
<li><a class="reference internal" href="#prepare-your-server">Prepare your server:</a></li>
<li><a class="reference internal" href="#create-a-package">Create a package:</a></li>
<li><a class="reference internal" href="#version-number-increments">Version number increments:</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="preparing_a_release.html"
                        title="previous chapter">Preparing a release</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="jenkins_ci.html"
                        title="next chapter">Continuous Integration Testing with Jenkins</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/developer-docs/preparing_test_builds.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="jenkins_ci.html" title="Continuous Integration Testing with Jenkins"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="preparing_a_release.html" title="Preparing a release"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Home</a> &raquo;</li>
    <li><a href="../contents.html">Contents</a> &raquo;</li>

          <li><a href="index.html" >InaSAFE developer documentation</a> &raquo;</li> 
      </ul>
    </div>
    </div>

    <div class="footer">
        &copy; Copyright 2012, BNPB/AIFDR/GFDRR.
      Last updated on Feb 25, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
    <!-- cloud_sptheme 1.3 -->
  </body>
</html>