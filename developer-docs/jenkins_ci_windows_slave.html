


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Set up of Windows ‘slave’ builds for Jenkins &mdash; InaSAFE 1.0.1-final documentation</title>
    
    <link rel="stylesheet" href="../_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noticia+Text|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.1-final',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../_static/toggle_sections.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="InaSAFE 1.0.1-final documentation" href="../index.html" />
    <link rel="up" title="InaSAFE developer documentation" href="index.html" />
    <link rel="next" title="IRC Notes for InaSAFE" href="irc.html" />
    <link rel="prev" title="Continuous Integration Testing with Jenkins" href="jenkins_ci.html" /> 
  </head>
  <body>
    <div class="relbar-top">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="irc.html" title="IRC Notes for InaSAFE"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="jenkins_ci.html" title="Continuous Integration Testing with Jenkins"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Home</a> &raquo;</li>
    <li><a href="../contents.html">Contents</a> &raquo;</li>

          <li><a href="index.html" accesskey="U">InaSAFE developer documentation</a> &raquo;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="set-up-of-windows-slave-builds-for-jenkins">
<h1>Set up of Windows &#8216;slave&#8217; builds for Jenkins<a class="headerlink" href="#set-up-of-windows-slave-builds-for-jenkins" title="Permalink to this headline">¶</a></h1>
<div class="section" id="outline-of-procedure">
<h2>Outline of procedure:<a class="headerlink" href="#outline-of-procedure" title="Permalink to this headline">¶</a></h2>
<p>Set up a virtual machine. In our testing regieme we will be using:</p>
<ul class="simple">
<li>Windows 8 64bit</li>
<li>Windows 8 32bit</li>
<li>Windows 7 64bit</li>
<li>Windows 7 32bit</li>
</ul>
<p>We have purchased licenses of these OS&#8217;s specifically for deployment in
our VirtualBox virtual machines. The setup and installation of windows and
VirtualBox is not described here except as pertains to testing. We will be
installing the following components on each windows slave:</p>
<ul class="simple">
<li><strong>Microsoft .net 3.5 (versions 4+ are not supported).</strong> Under windows 8 you
need to do this as an explicit install as the OS ships with .net 4.5. .net is
needed to run the Jenkins service.</li>
<li><strong>Python 2.7.</strong> Although QGIS ships with a python interpreter, we need
to install our own copy to support running unit tests and so on.</li>
<li><strong>QGIS (1.8 at time of writing).</strong> The unit tests depend on QGIS being present
to run.</li>
<li><strong>GitHub for Windows.</strong> This is the convenient windows GIT client provided
by GitHub - we will use it to clone and update our repositories.</li>
</ul>
<p>With the base software installed, we will clone two GitHub repositories to
the VM:</p>
<ul class="simple">
<li><strong>InaSAFE.</strong> The application that we will be testing.</li>
<li><strong>inasafe_data.</strong> Test data required for unit testing the InaSAFE library.</li>
</ul>
<p>Then we will configure the system to be able to run the unit tests, first
independently of Jenkins, and then as a Jenkins job.</p>
<p>Lastly, we will configure the VM Jenkins instance to be a slave for our Jenkins
master and fire off the InaSAFE test suite in the VM whenever a commit is made
to the InaSAFE master branch.</p>
<p>We will try to keep things as simple as possible. The VM instances should not
be used for any other purpose in order to keep them small, fast and to avoid
configuration issues caused by conflicting libraries.</p>
</div>
<div class="section" id="vm-configuration">
<h2>VM Configuration:<a class="headerlink" href="#vm-configuration" title="Permalink to this headline">¶</a></h2>
<p>We used the following configuration options when creating our virtual machines:</p>
<ul class="simple">
<li>4 GB Ram (thus your host OS needs 8GB or more)</li>
<li>25 GB Virtual Hard Disk</li>
<li>Installation of guest extensions.</li>
</ul>
<p>All virtual machines were created using the free VirtualBox software.</p>
<p>Note that you may need to enable virtualisation in your PC bios too.</p>
<p>All Virtual Machines were created with a <em>local</em> user account with</p>
<p>Username: inasafe
Password: XXXXXX (redacted)</p>
<p>We did not enable the new &#8216;cloud login&#8217; options of Windows 8.</p>
<p>After the windows installation, we turned off all extraneous services to
maximise performance and increase test times.</p>
</div>
<div class="section" id="software-installation">
<h2>Software Installation<a class="headerlink" href="#software-installation" title="Permalink to this headline">¶</a></h2>
<p>The following were the standard software installed on each Windows VM:</p>
<div class="section" id="qgis-install">
<h3>QGIS Install<a class="headerlink" href="#qgis-install" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Install QGIS standalone from <a class="reference external" href="http://download.qgis.org">http://download.qgis.org</a></li>
<li>Create the .qgispythonplugins dir</li>
</ul>
</div>
<div class="section" id="github-for-windows-install">
<h3>GitHub for Windows Install<a class="headerlink" href="#github-for-windows-install" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Install from <a class="reference external" href="http://windows.github.com">http://windows.github.com</a></li>
<li>Do not log in with your account details (for security)</li>
<li>In options, set your default storage directory to
<tt class="file docutils literal"><span class="pre">C:Usersinasafe.qgispythonplugins</span></tt></li>
</ul>
<p>Copy over the repositories from the host system (quickest) or check them out
from github anonymously. If you take the former route, after copying them in
to the plugins directory use the GitHub Windows app&#8217;s options dialog to find
them by clicking the &#8216;scan for repositories&#8217; button.</p>
</div>
<div class="section" id="python-install">
<h3>Python Install<a class="headerlink" href="#python-install" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Download and install Python <strong>32Bit</strong> (even if you are running a 64 bit
windows!!!) to match the version of python shipped with QGIS (python 2.7 in
the case of QGIS 1.8).</li>
<li>Follow the process described in <em class="xref std std-ref">windows_shell_launcher-label</em> so that
you can use the QGIS libraries from a python shell. Note that you probably
need to change the second last line of that script to <tt class="samp docutils literal"><span class="pre">cd</span> <span class="pre">&quot;%HOMEPATH%.qgispythonpluginsinasafe&quot;</span></tt> (removing the &#8216;-dev&#8217;) at the end.</li>
<li>Follow the processed described in <em class="xref std std-ref">windows-nose-setup</em> so that you have
a working pip, nose etc.</li>
</ul>
<p>Now run the tests and ensure that they can be run from the command line
<em>before</em> attempting to run them via Jenkins:</p>
<div class="highlight-python"><pre>C:\Users\inasafe\.qgis\python\plugins\inasafe&gt;runtests.bat</pre>
</div>
</div>
<div class="section" id="net-3-5-install">
<h3>.net 3.5 Install<a class="headerlink" href="#net-3-5-install" title="Permalink to this headline">¶</a></h3>
<p>To install Jenkins, you first need to ensure you have .net 3.5 on your system.
Windows 8 ships with .net 4+ so you need to manually install the older version
too. First visit <a class="reference external" href="http://www.microsoft.com/en-us/download/details.aspx?id=21">http://www.microsoft.com/en-us/download/details.aspx?id=21</a>
and either choose the .NET Framework Full Package (around 200mb, the option
I took) or get the online installer. Note that the full package link is near
the bottom of the page.</p>
<p>Run the installer and accept all the defaults to install the .net 3.5
framework.</p>
</div>
<div class="section" id="jenkins-install">
<h3>Jenkins Install<a class="headerlink" href="#jenkins-install" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Simply go to <a class="reference external" href="http://jenkins-ci.org/">http://jenkins-ci.org/</a> and download the windows native package</dt>
<dd>and then install it, taking all the defaults.</dd>
</dl>
<p>Once Jenkins is set up, open your browser at <a class="reference external" href="http://localhost:8080">http://localhost:8080</a> to access
the Jenkins page.</p>
</div>
</div>
<div class="section" id="jenkins-configuration">
<h2>Jenkins Configuration<a class="headerlink" href="#jenkins-configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="plugins">
<h3>Plugins<a class="headerlink" href="#plugins" title="Permalink to this headline">¶</a></h3>
<p>The first thing you need to do is install some jenkins plugins. To do this
do <em class="menuselection">Manage Jenkins ‣ Manage Plugins ‣ Available tab</em>.</p>
<p>Now install at least these plugins:</p>
<ul class="simple">
<li>Jenkins GIT plugin</li>
<li>GitHub API plugin</li>
<li>GitHub plugin</li>
</ul>
<p>In addition these plugins should be available by default:</p>
<ul class="simple">
<li>Jenkins mailer plugin</li>
<li>External Monitor Job Type Plugin</li>
<li>pam-auth</li>
</ul>
<p>For simplicity, I also disabled the following plugins:</p>
<ul class="simple">
<li>LDAP Plugin</li>
<li>ant</li>
<li>javadoc</li>
<li>Jenkins CVS Plug-in</li>
<li>Maven Integration plugin</li>
<li>Jenkins SSH Slaves plugins</li>
<li>Jenkins Subversion plugin</li>
<li>Jenkins Translation Assistance plugin</li>
</ul>
</div>
<div class="section" id="system-configuration">
<h3>System configuration<a class="headerlink" href="#system-configuration" title="Permalink to this headline">¶</a></h3>
<p>7
We need to provide the path to git so that Jenkins can automatically make
checkouts of each version.</p>
<p><em class="menuselection">Jenkins ‣ Manage Jenkins ‣ Configuration ‣ Git
Installations ‣ Path to Git executable</em> needs to be set. On my system I used
the following path:</p>
<div class="highlight-python"><pre>C:\Users\inasafe\AppData\Local\GitHub\PortableGit_93e8418133eb85e81a81e5e19c272776524496c6\bin\git.exe</pre>
</div>
<p>The GitHub application&#8217;s git installer is a portable app and the path for you
is going to look a little different - just lookin in your AppData dir and you
should find it.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Jenkins system user will need to have read permissions on the
above directory.</p>
</div>
<p>Next populate the options in:</p>
<ul class="simple">
<li><em class="menuselection">Jenkins ‣ Manage Jenkins ‣ Configuration ‣ Git Plugins</em>:</li>
<li><em class="menuselection">Global Config user.name Value</em> : <tt class="kbd docutils literal"><span class="pre">&lt;your</span> <span class="pre">name&gt;</span></tt></li>
<li><em class="menuselection">Global Config user.email Value</em> : :kbd:<a href="#id1"><span class="problematic" id="id2">`</span></a>&lt;<a class="reference external" href="mailto:your&#37;&#52;&#48;email&#46;com">your<span>&#64;</span>email<span>&#46;</span>com</a>&gt;</li>
<li><em class="menuselection">Create new accounts base on author/committer&#8217;s email</em> : no</li>
</ul>
<p>Now click the <a href="#id3"><span class="problematic" id="id4">:guiselection:`Save Button`</span></a> to save your global configuration
changes.</p>
</div>
<div class="section" id="job-configuration">
<h3>Job Configuration<a class="headerlink" href="#job-configuration" title="Permalink to this headline">¶</a></h3>
<p>Next we create our build job with the following options:</p>
<ul class="simple">
<li><em class="menuselection">Project name</em> : <tt class="kbd docutils literal"><span class="pre">inasafe-win8-64</span></tt> (adjust the name as
appropriate)</li>
<li><em class="menuselection">Build a free-style software project</em> : select</li>
</ul>
<p>On the job configuration page use the following options:</p>
<ul class="simple">
<li><em class="menuselection">Description</em> : <tt class="kbd docutils literal"><span class="pre">Windows</span> <span class="pre">8</span> <span class="pre">64</span> <span class="pre">bit</span> <span class="pre">build</span> <span class="pre">of</span> <span class="pre">InaSAFE</span></tt></li>
<li><em class="menuselection">GitHub project</em> : <tt class="kbd docutils literal"><span class="pre">http://github.com/AIFDR/inasafe/</span></tt></li>
<li><em class="menuselection">Source Code Management</em> section</li>
<li><em class="menuselection">Git</em> : Check</li>
<li><em class="menuselection">Repository URL</em> : <tt class="kbd docutils literal"><span class="pre">git://github.com/AIFDR/inasafe.git</span></tt></li>
<li><em class="menuselection">Branches to build</em> : <tt class="kbd docutils literal"><span class="pre">version-1_1</span></tt></li>
<li><em class="menuselection">Repository browser</em> : <tt class="kbd docutils literal"><span class="pre">githubweb</span></tt></li>
<li><em class="menuselection">Url</em> : <tt class="kbd docutils literal"><span class="pre">http://github.com/AIFDR/inasafe/</span></tt></li>
<li><em class="menuselection">Build triggers</em> section</li>
<li><em class="menuselection">Poll SCM</em> : check and set to <tt class="kbd docutils literal"><span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span></tt> for
minutely checks.</li>
</ul>
<p>Save your changes at this point and make a commit, you should see the job
produce output something like this the next time a commit takes place:</p>
<div class="highlight-python"><pre>Started by timer
Building in workspace C:\Jenkins\jobs\inasafe-win8-64\workspace
Checkout:workspace / C:\Jenkins\jobs\inasafe-win8-64\workspace - hudson.remoting.LocalChannel@1fd5730
Using strategy: Default
Last Built Revision: Revision 5403e3ba45129b42edaa2bc0ebd12e8c9ead868e (origin/version-1_1)
Fetching changes from 1 remote Git repository
Fetching upstream changes from git://github.com/AIFDR/inasafe.git
Commencing build of Revision 5403e3ba45129b42edaa2bc0ebd12e8c9ead868e (origin/version-1_1)
Checking out Revision 5403e3ba45129b42edaa2bc0ebd12e8c9ead868e (origin/version-1_1)
Finished: SUCCESS</pre>
</div>
<p>That validates that at least your git checkout is working as expected.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="../contents.html">
          <img class="logo" src="../_static/icon.png" alt="Logo"/>
        </a></p>
  <h3><a href="../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Set up of Windows &#8216;slave&#8217; builds for Jenkins</a><ul>
<li><a class="reference internal" href="#outline-of-procedure">Outline of procedure:</a></li>
<li><a class="reference internal" href="#vm-configuration">VM Configuration:</a></li>
<li><a class="reference internal" href="#software-installation">Software Installation</a><ul>
<li><a class="reference internal" href="#qgis-install">QGIS Install</a></li>
<li><a class="reference internal" href="#github-for-windows-install">GitHub for Windows Install</a></li>
<li><a class="reference internal" href="#python-install">Python Install</a></li>
<li><a class="reference internal" href="#net-3-5-install">.net 3.5 Install</a></li>
<li><a class="reference internal" href="#jenkins-install">Jenkins Install</a></li>
</ul>
</li>
<li><a class="reference internal" href="#jenkins-configuration">Jenkins Configuration</a><ul>
<li><a class="reference internal" href="#plugins">Plugins</a></li>
<li><a class="reference internal" href="#system-configuration">System configuration</a></li>
<li><a class="reference internal" href="#job-configuration">Job Configuration</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="jenkins_ci.html"
                        title="previous chapter">Continuous Integration Testing with Jenkins</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="irc.html"
                        title="next chapter">IRC Notes for InaSAFE</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/developer-docs/jenkins_ci_windows_slave.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="irc.html" title="IRC Notes for InaSAFE"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="jenkins_ci.html" title="Continuous Integration Testing with Jenkins"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Home</a> &raquo;</li>
    <li><a href="../contents.html">Contents</a> &raquo;</li>

          <li><a href="index.html" >InaSAFE developer documentation</a> &raquo;</li> 
      </ul>
    </div>
    </div>

    <div class="footer">
        &copy; Copyright 2012, BNPB/AIFDR/GFDRR.
      Last updated on Feb 25, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
    <!-- cloud_sptheme 1.3 -->
  </body>
</html>