


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Postprocessors &mdash; InaSAFE 1.0.1-final documentation</title>
    
    <link rel="stylesheet" href="../_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noticia+Text|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.1-final',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../_static/toggle_sections.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="InaSAFE 1.0.1-final documentation" href="../index.html" />
    <link rel="up" title="InaSAFE developer documentation" href="index.html" />
    <link rel="next" title="Reporting bugs and getting help" href="bug_reporting.html" />
    <link rel="prev" title="Impact Function Tutorial" href="impact_function_tutorial.html" /> 
  </head>
  <body>
    <div class="relbar-top">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="bug_reporting.html" title="Reporting bugs and getting help"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="impact_function_tutorial.html" title="Impact Function Tutorial"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Home</a> &raquo;</li>
    <li><a href="../contents.html">Contents</a> &raquo;</li>

          <li><a href="index.html" accesskey="U">InaSAFE developer documentation</a> &raquo;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="postprocessors">
<h1>Postprocessors<a class="headerlink" href="#postprocessors" title="Permalink to this headline">¶</a></h1>
<p>This document explains the purpose of postprocessors and lists the
different available postprocessor and the requirements each has to be
used effectively.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This document is still a work in progress.</p>
</div>
<div class="section" id="what-is-a-postprocessor">
<h2>What is a postprocessor?<a class="headerlink" href="#what-is-a-postprocessor" title="Permalink to this headline">¶</a></h2>
<p>A postprocessor is a function that takes the results from the impact function
and calculates derivative indicators, for example if you have an affected
population total, the Gender postprocessor will calculate gender specific
indicators such as additional nutritional requirements for pregnant women</p>
</div>
<div class="section" id="creating-postprocessors">
<h2>Creating postprocessors<a class="headerlink" href="#creating-postprocessors" title="Permalink to this headline">¶</a></h2>
<p>Adding a new postprocessor is as simple as adding a new class called
XxxxxxPostprocessor that inherits AbstractPostprocessor with one mandatory
method (process), 2 optional ones and as many indicators as you need.</p>
<p>the minimal class could look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MySuperPostprocessor</span><span class="p">(</span><span class="n">AbstractPostprocessor</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">AbstractPostprocessor</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="n">AbstractPostprocessor</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">AbstractPostprocessor</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">AbstractPostprocessor</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calculate_my_indicator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">A</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">myResult</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">A</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_append_result</span><span class="p">(</span><span class="s">&#39;My Indicator&#39;</span><span class="p">,</span> <span class="n">myResult</span><span class="p">)</span>
</pre></div>
</div>
<p>After that you need to import the new class into postprocessor_factory and
update AVAILABLE_POSTPTOCESSORS to include the postprocessor prefix (e.g.
MySuper if the class is called MySuperPostprocessor and its human readable name)</p>
<p>As last step you have to update or add the <em>parameters</em> variable to the impact
functions that you want to use the new postprocessor. This will need to include
a dicionary of the available postprocessors as shown below.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;thresholds&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
        <span class="s">&#39;postprocessors&#39;</span><span class="p">:</span>
            <span class="p">{</span><span class="s">&#39;Gender&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;on&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
             <span class="s">&#39;Age&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;on&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                     <span class="s">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s">&#39;youth_ratio&#39;</span><span class="p">:</span> <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;YOUTH_RATIO&#39;</span><span class="p">],</span>
                        <span class="s">&#39;adult_ratio&#39;</span><span class="p">:</span> <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;ADULT_RATIO&#39;</span><span class="p">],</span>
                        <span class="s">&#39;elder_ratio&#39;</span><span class="p">:</span> <span class="n">defaults</span><span class="p">[</span><span class="s">&#39;ELDER_RATIO&#39;</span><span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
              <span class="s">&#39;MySuper&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;on&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
             <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>or as a minimum:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;postprocessors&#39;</span><span class="p">:{</span><span class="s">&#39;MySuper&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;on&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}}}</span>
</pre></div>
</div>
<p>for implementation examples see AgePostprocessor and GenderPostprocessor which
both use mandatory and optional parameters</p>
</div>
<div class="section" id="output">
<h2>Output<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h2>
<p>Dock.postprocOutput will hold the result datastructure (shown below) of all the
postprocessors. The structure is then parsed by Dock._postProcessingOutput() and
stored in the impact layer&#8217;s keywords
If a postprocessor generates no output (for example due to calculation errors),
then it will just be skipped from the report</p>
<div class="section" id="data-structure-of-results">
<h3>Data structure of results<a class="headerlink" href="#data-structure-of-results" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;Gender&#39;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">QString</span><span class="p">(</span><span class="s">u&#39;JAKARTA BARAT&#39;</span><span class="p">),</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s">u&#39;Total&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">278349</span><span class="p">,</span> <span class="s">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{}}),</span>
                                             <span class="p">(</span><span class="s">u&#39;Females count&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">144741</span><span class="p">,</span> <span class="s">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{}}),</span>
                                             <span class="p">(</span><span class="s">u&#39;Females weekly hygiene packs&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">114881</span><span class="p">,</span> <span class="s">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;Females hygiene packs for weekly use&#39;</span><span class="p">}})])),</span>
    <span class="p">(</span><span class="n">QString</span><span class="p">(</span><span class="s">u&#39;JAKARTA UTARA&#39;</span><span class="p">),</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s">u&#39;Total&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">344655</span><span class="p">,</span> <span class="s">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{}}),</span>
                                             <span class="p">(</span><span class="s">u&#39;Females count&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">179221</span><span class="p">,</span> <span class="s">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{}}),</span>
                                             <span class="p">(</span><span class="s">u&#39;Females weekly hygiene packs&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">142247</span><span class="p">,</span> <span class="s">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;Females hygiene packs for weekly use&#39;</span><span class="p">}})]))],</span>
 <span class="s">&#39;Age&#39;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">QString</span><span class="p">(</span><span class="s">u&#39;JAKARTA BARAT&#39;</span><span class="p">),</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s">u&#39;Total&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">278349</span><span class="p">,</span> <span class="s">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{}}),</span>
                                             <span class="p">(</span><span class="s">u&#39;Youth count&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">73206</span><span class="p">,</span> <span class="s">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{}}),</span>
                                             <span class="p">(</span><span class="s">u&#39;Adult count&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">183432</span><span class="p">,</span> <span class="s">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{}}),</span>
                                             <span class="p">(</span><span class="s">u&#39;Elderly count&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">21990</span><span class="p">,</span> <span class="s">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{}})])),</span>
    <span class="p">(</span><span class="n">QString</span><span class="p">(</span><span class="s">u&#39;JAKARTA UTARA&#39;</span><span class="p">),</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s">u&#39;Total&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">344655</span><span class="p">,</span> <span class="s">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{}}),</span>
                                             <span class="p">(</span><span class="s">u&#39;Youth count&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">90644</span><span class="p">,</span> <span class="s">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{}}),</span>
                                             <span class="p">(</span><span class="s">u&#39;Adult count&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">227128</span><span class="p">,</span> <span class="s">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{}}),</span>
                                             <span class="p">(</span><span class="s">u&#39;Elderly count&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mi">27228</span><span class="p">,</span> <span class="s">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{}})]))</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="../contents.html">
          <img class="logo" src="../_static/icon.png" alt="Logo"/>
        </a></p>
  <h3><a href="../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Postprocessors</a><ul>
<li><a class="reference internal" href="#what-is-a-postprocessor">What is a postprocessor?</a></li>
<li><a class="reference internal" href="#creating-postprocessors">Creating postprocessors</a></li>
<li><a class="reference internal" href="#output">Output</a><ul>
<li><a class="reference internal" href="#data-structure-of-results">Data structure of results</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="impact_function_tutorial.html"
                        title="previous chapter">Impact Function Tutorial</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="bug_reporting.html"
                        title="next chapter">Reporting bugs and getting help</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/developer-docs/postprocessors.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="bug_reporting.html" title="Reporting bugs and getting help"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="impact_function_tutorial.html" title="Impact Function Tutorial"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Home</a> &raquo;</li>
    <li><a href="../contents.html">Contents</a> &raquo;</li>

          <li><a href="index.html" >InaSAFE developer documentation</a> &raquo;</li> 
      </ul>
    </div>
    </div>

    <div class="footer">
        &copy; Copyright 2012, BNPB/AIFDR/GFDRR.
      Last updated on Feb 26, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
    <!-- cloud_sptheme 1.3 -->
  </body>
</html>